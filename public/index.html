<!DOCTYPE html>
<html>
<head>
  <title>Pong</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

<div class="container-fluid">
  <div class="row">
    <div class="col-xs-12">
      <div id="controller-blocked" class="alert alert-danger alert-dismissible" style="display: none;">
        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
        <strong>Unable to open controller.</strong> It may have been blocked by your popup blocker -- please allow the window to open in order to play the game.
      </div>
      <h1>Realtime Pong!  <small class="text-muted">An accompaniment to <a href="https://medium.com/@semw/being-protocol-agnostic-at-ably-eb36342a644c">this blog post</a></small></h1>
      <p>A game of Pong, borrowed <a href="https://www.pubnub.com/developers/demos/pongnub/">from Pubnub (thanks!)</a>, with five separate instances, each using a different realtime backend: Ably, our Pusher adapter, our Pubnub adapter, Pusher and Pubnub. All of them are simultaneously controllable from the same controller, so you can see how well they work. (The first three all use the same Ably channel behind the scene, to demonstrate interoperability). See <a href="https://medium.com/@semw/being-protocol-agnostic-at-ably-eb36342a644c">this blog post</a> for more context.</p>
      <button id="start" class="btn btn-primary">Start</button>
      <button id="open-controller" class="btn btn-danger">Open controller</button>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12 col-md-6 col-lg-4">
      <h2>Ably</h2>
      <canvas id="ably"></canvas>
    </div>

    <div class="col-xs-12 col-md-6 col-lg-4">
      <h2>Pusher translator</h2>
      <canvas id="pusher-translator"></canvas>
    </div>

    <div class="col-xs-12 col-md-6 col-lg-4">
      <h2>Pubnub translator</h2>
      <canvas id="pubnub-translator"></canvas>
    </div>

    <div class="col-xs-12 col-md-6 col-lg-4">
      <h2>Pusher</h2>
      <canvas id="pusher-native"></canvas>
    </div>

    <div class="col-xs-12 col-md-6 col-lg-4">
      <h2>Pubnub</h2>
      <canvas id="pubnub-native"></canvas>
    </div>

  </div>
</div>


<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
<script src="//cdn.pubnub.com/pubnub.js"></script>
<script src="//js.pusher.com/3.1/pusher.js"></script>
<script src="//cdn.ably.io/lib/ably.js"></script>
<script src="js/game.js" type="text/javascript"></script>
<script src="js/pong.js" type="text/javascript"></script>
<script src="js/pubgame.js" type="text/javascript"></script>
<script src="js/utils.js" type+"text/javascript"></script>
<script type="text/javascript">

  window.pong = { games: {} };
  window.pong.sessionId = createOrRetrieveSessionId();

  Game.ready(function() {
    _.each([
      'pubnub-native',
      'pubnub-translator',
      'ably',
      'pusher-native',
      'pusher-translator',
    ], function(id) {
      Game.start(id, Pong, { sound: false, });
    })

    $(document).ready( function() {
      $('#start').click(function() {
        for(var pongGame in window.pong.games) {
          window.pong.games[pongGame].startSinglePlayer();
        }
      });
    });
  });

  function openController() {
    var controller = window.open('./controller.html?id=' + window.pong.sessionId, 'controller', 'height=400,width=200');
    if (window.focus) {
      controller.focus()
    }
    if(!controller || controller.closed || typeof controller.closed === 'undefined') {
      $('#controller-blocked').slideDown();
    } else {
      $('#controller-blocked').hide();
    }
  }
  $('#open-controller').click(openController);

</script>
</body>
</html>

